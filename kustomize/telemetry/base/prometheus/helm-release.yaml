apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kube-prometheus-stack
  namespace: system-telemetry
spec:
  interval: 5m
  timeout: 5m
  chart:
    spec:
      chart: kube-prometheus-stack
      # renovate: datasource=helm depName=kube-prometheus-stack package=kube-prometheus-stack helmRepo=https://prometheus-community.github.io/helm-charts
      version: 80.0.0
      sourceRef:
        kind: HelmRepository
        name: prometheus-community
        namespace: system-gitops
  values:
    grafana:
      enabled: false
    kubeStateMetrics:
      enabled: true
    kube-state-metrics:
      image:
        # renovate: datasource=docker depName=registry.k8s.io/kube-state-metrics/kube-state-metrics package=registry.k8s.io/kube-state-metrics/kube-state-metrics
        tag: v2.17.0@sha256:2bbc915567334b13632bf62c0a97084aff72a36e13c4dabd5f2f11c898c5bacd
    prometheusOperator:
      image:
        # renovate: datasource=docker depName=quay.io/prometheus-operator/prometheus-operator package=quay.io/prometheus-operator/prometheus-operator
        tag: v0.87.0@sha256:bea2b1a73fdd6a7eabc9af69903395406cf64c9d69f65b08fa01f587fe5369d6
      admissionWebhooks:
        patch:
          image:
            # renovate: datasource=docker depName=registry.k8s.io/ingress-nginx/kube-webhook-certgen package=registry.k8s.io/ingress-nginx/kube-webhook-certgen
            tag: v20221220-controller-v1.5.1-58-g787ea74b6@sha256:4d99688e557396f5baa150e019ff7d5b7334f9b9f9a8dab64038c5c2a006f6b5
    prometheus:
      prometheusSpec:
        # renovate: datasource=github-releases depName=prometheus/prometheus package=prometheus/prometheus
        version: v3.8.0
        image:
          # renovate: datasource=docker depName=quay.io/prometheus/prometheus package=quay.io/prometheus/prometheus
          tag: v3.8.0@sha256:d936808bdea528155c0154a922cd42fd75716b8bb7ba302641350f9f3eaeba09
        ruleSelectorNilUsesHelmValues: false
        serviceMonitorSelectorNilUsesHelmValues: false
        podMonitorSelectorNilUsesHelmValues: false
        probeSelectorNilUsesHelmValues: false
        serviceMonitorNamespaceSelector: { }
        serviceMonitorSelector: { }
        podMonitorNamespaceSelector: { }
        podMonitorSelector: { }
    nodeExporter:
      enabled: true
      replicas: 1
    prometheus-node-exporter:
      # renovate: datasource=github-releases depName=prometheus/node_exporter package=prometheus/node_exporter
      version: v1.10.2
      image:
        # renovate: datasource=docker depName=quay.io/prometheus/node-exporter package=quay.io/prometheus/node-exporter
        tag: v1.10.2@sha256:337ff1d356b68d39cef853e8c6345de11ce7556bb34cda8bd205bcf2ed30b565
        digest: ""
